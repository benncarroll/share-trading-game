var av_apikeys=["KG1KK45RLO6JUH8E","4HE01ZBSKAU119I5","KZE9QD4U395CQPKK","J5CL9UT0N30A7RBP","2JRTPYDXAWEQZPH2","06SB4P9CAAL9L4R5"];var av_apikey=av_apikeys[Math.floor(Math.random()*av_apikeys.length)];var av_data;var dataUpdates=0;var stockData={WBC:{name:"WBC",price:0,movement:"up",ownedQuantity:0},NAB:{name:"NAB",price:0,movement:"up",ownedQuantity:0},WES:{name:"WES",price:0,movement:"down",ownedQuantity:0},BHP:{name:"BHP",price:0,movement:"up",ownedQuantity:0},TLS:{name:"TLS",price:0,movement:"down",ownedQuantity:0},BKL:{name:"BKL",price:0,movement:"down",ownedQuantity:0},QAN:{name:"QAN",price:0,movement:"up",ownedQuantity:0},RIO:{name:"RIO",price:0,movement:"down",ownedQuantity:0}};var eventsData={0:{index:0,title:"Banking royal commission: Westpac defective lending controls exposed in review",body:"Internal Westpac board documents published by the banking royal commission reveal an independent review by PwC last year found only one out of 10 lending controls required by the prudential regulator were operating effectively.<br><br>The report raised concerns from senior risk managers that the bank may be hit with class action litigation in the event of a downturn, and such legal action could challenge the basis for loan security.<br><br>An explosive, previously confidential memorandum to the Westpac board last year shows how the nation&apos;s second-largest mortgage lender scrambled to respond to poor results from the Australian Prudential Regulation Authority&apos;s &apos;targeted review&apos;  of borrower income and expense verification.<br><br>Westpac also fretted it had breached trust with the regulator, after APRA chairman Wayne Byres personally berated the bank as being a &apos;significant outlier&apos; with respect to high risk lending.",source:"Financial Review"}};var upgradeData={};function getAlphaData(b){var a="https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol="+b.name+".AX&interval=1min&apikey="+av_apikey;$.get(a,function(c){brokenObj=false;if(c["Error Message"]==undefined&&c.Information==undefined&&c["Meta Data"]==undefined){brokenObj=true}if(!brokenObj){if(c["Error Message"]==undefined){b.data=c;obj=c["Time Series (1min)"];b.price=Number(obj[Object.keys(obj).sort()[Object.keys(obj).length-1]]["4. close"]);dataUpdates+=1}else{dataUpdates-=1}}else{dataUpdates-=1}})}function loadNewAlphaData(){dataUpdates=0;timeSep=500;for(var a in stockData){if(stockData.hasOwnProperty(a)){s=stockData[a];getAlphaData(s)}}populateStockTable()}function populateStockTable(){$("#stockInfoInsertPoint").empty();var c=[];for(var b in stockData){c.push([b,stockData[b]["name"]])}c.sort();for(var a in c){b=c[a][0];if(stockData.hasOwnProperty(b)){s=stockData[b];if(s.movement=="up"){priceColour="green";movementText="↑"}else{priceColour="red";movementText="↓"}holdingAmt=(s.price*s.ownedQuantity).toFixed(2);constructedRow="<tr><td>"+s.name+"</td><td class='price-column'><kbd style='background:"+priceColour+"'>"+s.price+"</kbd></td><td style='color:"+priceColour+"'>"+movementText+"</td><td>"+s.ownedQuantity+"</td><td>$"+holdingAmt+"</td><td class='w-87'> <input min='0' type='number' data-type='buyQty' data-type2='buy' class='text-monospace buySell' data-stock='"+s.name+"' rows='1' cols='4' />&nbsp;&nbsp; <a data-type='buy' class='text-success buySellButton' data-stock='"+s.name+"' href='javascript:void(0)'>Buy</a></td><td class='w-87'> <input min='0' type='number' data-type='sellQty' data-type2='sell' class='text-monospace buySell' data-stock='"+s.name+"' rows='1' cols='4' />&nbsp;&nbsp; <a data-type='sell' class='text-info buySellButton' data-stock='"+s.name+"' href='javascript:void(0)'>Sell</a></td></tr>";$("#stockInfoInsertPoint").append(constructedRow);if(!initialDataLoaded){$("#stockInfoInsertPoint").find("input, textarea, button, select").attr("disabled",true);$("#stockInfoInsertPoint").find("input, textarea, button, select").addClass("disabled")}}}}function populateNewsTable(){$("#newsArticleInsertPoint").empty();var c=[];for(var b in eventsData){c.push([b,eventsData[b]["name"]])}c.sort();for(var a in eventsData){if(eventsData.hasOwnProperty(a)){a=eventsData[a];constructedRow="<tr><td rows=1>"+a.title+"</td><td><a href='javascript:void(0)' onclick='summonNewsArticle("+a.index+"'>View</a></td></tr>";$("#newsArticleInsertPoint").append(constructedRow)}}}function saveUserData(){if(localStorage.getItem("userData")==null){craftedStorage={timeStarted:0,userCash:5000,userStocks:{},cs:0}}else{craftedStorage=JSON.parse(localStorage.getItem("userData"))}craftedStorage.userCash=Number(cash);cs=craftedStorage.userCash;if(craftedStorage.timeStarted==0){craftedStorage.timeStarted=timeStarted}cs*=craftedStorage.timeStarted;craftedStorage.userStocks={};for(var a in stockData){if(stockData.hasOwnProperty(a)){s=stockData[a];craftedStorage.userStocks[s.name]={name:s.name,ownedQuantity:s.ownedQuantity};cs+=(s.ownedQuantity*3)}}craftedStorage.cs=cs;localStorage.setItem("userData",JSON.stringify(craftedStorage))}function loadUserData(){$("#loading-reason").text("Fetching previous user data...");if(localStorage.getItem("userData")==null){saveUserData()}userData=JSON.parse(localStorage.getItem("userData"));cs=Number(userData.userCash);cs*=Number(userData.timeStarted);for(var a in userData.userStocks){if(userData.userStocks.hasOwnProperty(a)){ss=userData.userStocks[a];cs+=(Number(ss.ownedQuantity)*3)}}if(cs!=Number(userData.cs)){doLog("Checksum invalid - Setting values to 0.");localStorage.removeItem("userData");saveUserData();loadUserData();summonModal("Data reset","Your statistics have been reset as the save file was tampered with.<br>Your cash values and share holdings have been reset.","Don't cheat!");return}else{doLog("Checksum validated - User data loaded.")}cash=Number(userData.userCash);timeStarted=Number(userData.timeStarted);for(var a in userData.userStocks){if(userData.userStocks.hasOwnProperty(a)){ss=userData.userStocks[a];if(stockData.hasOwnProperty(a)){s=stockData[a];s.ownedQuantity=ss.ownedQuantity}}}};